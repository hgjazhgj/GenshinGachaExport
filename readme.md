# A Refactored Genshin Gacha Export Script
本项目是对[sunfkny/genshin-gacha-export](https://github.com/sunfkny/genshin-gacha-export/)的精简与重构  
我用那个项目已经很久了,反正clone下来双击运行就完事.但是1.4版本更新后mihoyo往获取抽卡日志的api里加了一个对我们来说毫无用处的id,导致先前的合并功能失效并且破坏先前的数据,于是本人试图修复一下这个bug  
很快啊,往代码里贴一块狗皮膏药很方便,但是我发现这代码又臭又长,看着看着人脑内存溢出,其他的牢骚我就不发了,我来说说我这个项目干了些什么事  
## 综述
这个项目是一个命令行工具,每个源码文件完成一项特定的功能,名副其实的高内聚低耦合  
本项目仅负责原神国服抽卡记录的爬取/合并/导出excel  
我的代码突出一个短,同时兼顾高效与可读性  
## convert
我原本以为原项目取得的json就是把mihoyo发来的原样dump下来,结果实际上是经过拼接合并的,那我为什么不继续做一些优化呢?  
从原项目取得的json中剔去用户不关心的部分,变更为本项目的格式  
这样可以完全避免新增域带来的错误,同时占据更少的磁盘空间(-60%)  
## capture
从国服游戏日志文件中获取authKey等信息,爬取抽卡记录  
移除了原先其他各种奇怪的获取方式,尤其是令人困惑的手动输入  
## merge
将爬取到的数据与本地数据合并  
采取了O(n)的区间合并,而非原项目的O(n^2)逐个添加  
合并必须要有东西合并,如果四个卡池中都没有重叠的记录会拒绝合并  
## writeXLSX
将抽卡记录导出为excel  
原项目采用了愚蠢的文件传参,将合并后的抽卡记录保存为json文件,然后这个模块去读  
这当然是应该直接上一步返回的字典直接传过去啊  
## main
main.py展示了一个基本的导出流程  
main.ipynb能帮助你优雅地使用这个项目  

## 更新日志
### 2021/04/13
移除了各模块的命令行,不会有人真的去用吧,那是给我调试时用的  
原作者在原项目里创建了一个重构分支...嗯他已经很努力地在写了,但还是我写的好一点  
修订readme  
### 2021/03/26
原项目更新了,修复了先前提到的合并问题,思路就是不看id  
但是我想到了我的合并的一个小问题:当获取到的最后一条记录是由十连产生的且该次十连还有至少一个相同物件出现时会出现重复的记录  
真可惜python的list没有rindex方法  
同时只要若干个卡池中有任何一个可以被合并(这表明了时间上确实有重叠)就接受所有卡池的合并结果  
另外,增加了一些输出  
